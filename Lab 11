#include <iostream>
#include <stdio.h>
#include <stdlib.h>
#include <time.h>

using std::cout;
using std::cin;
using std::endl;
//using std::hex;
//using std::dec;

float faddition(float x, float y);
float fsubtraction(float x, float y);
float fmultiplication(float x, float y);
float fdivision(float dividend, float divisor);
float fsquareroot(float x);
float fabsolute(float x);
float temperatureConv(float fahrenheit);

double daddition(double x, double y);
double dsubtraction(double x, double y);
double dmultiplication(double x, double y); 
double ddivision(double divident, double divisor);
double dpower(double d, double power);



int main()
{
	char ch, ch1, ch2, ch3;
	float f1, f2, fsum, fsub, fprod, fquot,fsqrt, fabs, ftempConv;
	double d1, d2, dsum, dsub;// , dprod, dquot, dpow;
	cout << "Start the floating point calculator? Y/N\n";
	cin >> ch;
	ch1 = ch;

	while (ch1 == 'Y' || ch1 == 'y')
	{
		cout << "MENU:\n";
		cout << "1, Single precision floating point arithmetic operation(32-bit)\n";
		cout << "2, Double precision floating point arithmetic operation(64-bit)\n";
		cout << "3, Exit\n";
		
		cin >> ch;
		cout << "You chose: " << ch << endl;
		cout << "Menu Options:\n";
		ch2 = ch;
		if (ch2 == '1')
		{
		Submenu1:
			cout << "a, Input two floating point operands for addition and display the sum in the decimal format\n";
			cout << "b, Input two floating point operands for subtraction and display the difference in the decimal format\n";
			cout << "c, Input two floating point operands for multiplication and display the product in the decimal format\n";
			cout << "d, Input two floating point operands for division and display the quotient in the decimal format\n";
			cout << "q, Quit\n";

			cin >> ch;
			cout << "You chose: " << ch << endl; 
			ch3 = ch;
			switch(ch3) 
			{
				case'a':
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cin >> f2;
					cout << "The first floating point value is " << f1 << endl;
					cout << "The second floating point value is " << f2 << endl;
					fsum = faddition(f1, f2);
					cout << "The sum of " << f1 << " and " << f2 << " is " << fsum << endl;
					cout << "=============================================================";
					break;
				}
				case'b':
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cin >> f2;
					cout << "The first floating point value is " << f1 << endl;
					cout << "The second floating point value is " << f2 << endl;
					fsub = fsubtraction(f1, f2);
					cout << "The difference of " << f1 << " and " << f2 << " is " << fsub << endl;
					cout << "=============================================================";
					break;
				}
				case'c':
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cin >> f2;
					cout << "The first floating point value is " << f1 << endl;
					cout << "The second floating point value is " << f2 << endl;
					fprod = fmultiplication(f1, f2);
					cout << "The product of " << f1 << " and " << f2 << " is " << fprod << endl;
					cout << "=============================================================";
					break;
				}
				case'd':
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cin >> f2;
					cout << "The first floating point value is " << f1 << endl;
					cout << "The second floating point value is " << f2 << endl;
					fquot = fdivision(f1, f2);
					cout << "The quotient of " << f1 << " and " << f2 << " is " << fquot << endl;
					cout << "=============================================================";
					break;
				}
				case'e': //sqrt done
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cout << "The first floating point value is " << f1 << endl;
					fsqrt = fsquareroot(f1);
					cout << "The sqrt of " << f1 << " is " << fsqrt << endl;
					cout << "=============================================================";
					break;
				}
				case'f'://abs done
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cout << "The first floating point value is " << f1 << endl;
					fabs = fabsolute(f1);
					cout << "The absolute value of " << f1 << " is " << fabs << endl;
					cout << "=============================================================";
					break;
				}
				case'g'://FtempC done
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> f1;
					cin >> f2;
					cout << "The first floating point value is " << f1 << endl;
					cout << "The second floating point value is " << f2 << endl;
					ftempConv = temperatureConv(f1);
					cout << "The temperature in C of " << f1 << "F, is: " << ftempConv << endl;
					cout << "=============================================================";
					break;
				}
				default: goto QuitLable;
			}
			goto Submenu2;
		}
		else if (ch2=='2')
		{
		Submenu2:
			cout << "a, Input two floating point operands for addition and display the sum in the decimal format.\n";
			cout << "b, Input two floating point operands for subtraction and display the difference in the decimal format. \n";
			cout << "q, Quit";

			cin >> ch;
			cout << "You chose: " << ch << endl; 
			ch3 = ch;
			switch (ch3) 
			{
				case 'a':
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> d1;
					cin >> d2;
					cout << "The first floating point value is " << d1 << endl;
					cout << "The second floating point value is " << d2 << endl;
					dsum = faddition(d1, d2);
					cout << "The sum of " << d1 << " and " << d2 << " is " << dsum << endl;
					cout << "=============================================================";
					break;
				}
				case 'b':
				{
					cout << "Input the two floating point operands in decimal format: \n";
					cin >> d1;
					cin >> d2;
					cout << "The first floating point value is " << d1 << endl;
					cout << "The second floating point value is " << d2 << endl;
					dsub = fsubtraction(d1, d2);
					cout << "The difference of " << d1 << " and " << d2 << " is " << dsub << endl;
					cout << "=============================================================";
					break; 
				}
				case 'c':
				{

				}
				case 'd':
				{

				}
				case 'e':
				{

				}
				default: goto QuitLable;
			}
			goto Submenu2;
		}
		else
		{
			goto EndLable;
		}
	QuitLable:
	cout << "Would you like to continue floating point arithmetic operations? Y/N: \n";
	cin >> ch;
	ch1 = ch;
	}
EndLable:
	cout << "Exit program\n";
	system("pause");
	exit(0);
	return 0;
}
float faddition(float x, float y)
{
	float f;
	_asm
	{
		FLD x;	//PUSH x
		FLD y;	//PUSH y, Move x further up stack
		FADD;	//add stack[0] and stack[1]. store at stack[0]
		FST f;	//copy to f
	}
	return f;
}
float fsubtraction(float x, float y)
{
	float f;
	_asm 
	{
		FLD x;
		FLD y;
		FSUB ST(1), ST(0);	//sub stack[0]-stack[1], store in stack[1]
		FXCH ST(1);			//move difference to stack[0]
		FST f;				//copy to f
	}
	return f;
}
float fmultiplication(float x, float y)
{
	float f;
	_asm
	{
		FLD x;
		FLD y;
		FMUL;	//mul stack[0] and stack[1], store at stack[0]
		FSTP f; //copy to f and pop from stack[0]
	}
	return f;
}
float fdivision(float x, float y)
{
	float f;
	_asm
	{
		FLD x;
		FLD y;
		FDIV ST(1), ST(0);	//div stack[0]-stack[1], store in stack[1]
		FXCH ST(1);			//move difference to stack[0]
		FSTP f;				//copy to f and pop from stack[0]					//FSTP not FTSP. The error cost me 2 days. 'opcode' error C2400
	}
	return f;
}
float fsquareroot(float x)
{
	float f;
	_asm
	{
		FLD x;
		FSQRT;
		FST f;
	}
	return f;
}
float fabsolute(float x)
{
	float f;
	_asm
	{
		FLD x;
		FABS;
		FST f;
	}
	return f;
}
float temperatureConv(float fahrenheit)
{
	float f;
	float f1;
	float f2;
	float f32 = 32.0;
	float f5 = 5.0;
	float f9 = 9.0;
	_asm
	{
		//subtract 32
		FLD fahrenheit;
		FLD f32;
		FSUB ST(1), ST(0);	//sub stack[0]-stack[1], store in stack[1]
		FXCH ST(1);			//move difference to stack[0]
		FSTP f1;
		//divide 9/5
		FLD f9; //mess around with this---------------------------------------------------------------------------------------------------------------------
		FLD f5;
		FDIV ST(1), ST(0);	//div stack[0]-stack[1], store in stack[1]
		FXCH ST(1);			//move difference to stack[0]
		FSTP f2;															//Same here, FSTP not FTSP. The error cost me 2 days. 'opcode' error C2400
		//multiply f-32 by 9/5
		FLD f1;
		FLD f2;
		FMUL;
		FSTP f;
	}
	return f;
}

double daddition(double x, double y)
{
	double d;
	_asm
	{
		FLD x;
		FLD y;
		FADD;  //add
		FST d; //copy to d
	}
	return d;
}
double dsubtraction(double x, double y)
{
	double d;
	_asm
	{
		FLD x;
		FLD y;
		FSUB ST(1), ST(0); //0 - 1, store in 1
		FXCH ST(1);		   //move to 0
		FST d;
	}
}
double dmultiplication(double x, double y)
{
	double d;
	_asm
	{
		FLD x;
		FLD y;
		FMUL;
		FSTP d;
	}
	return d;
}
double ddivision(double divident, double divisor)
{
	double d;
	_asm
	{
		FLD divident;
		FLD divisor;
		FDIV ST(1), ST(0);  //division as always
		FXCH ST(1);
		FSTP d;
	}
	return d;
}
double dpower(double d, double power)
{
	double d1;
	_asm
	{
		FLD d;
		FLD d;
		FMUL;
	}
	return d1;
}
//from part 2, add:
// F to C
// Abs val
//sqrt
//power(x^p) thingie
//
//add all into the switch after submenu2
//don't forget variable names

